#!/bin/bash

set -e

PANEL_DIR="/var/www/pterodactyl"

cd $PANEL_DIR

echo "ğŸ”§ Putting panel into maintenance mode..."
php artisan down || true

echo "â¬‡ï¸ Downloading latest Pterodactyl panel release..."
curl -L https://github.com/pterodactyl/panel/releases/latest/download/panel.tar.gz -o panel.tar.gz

echo "ğŸ“¦ Extracting update..."
tar -xzvf panel.tar.gz
rm panel.tar.gz

echo "ğŸ“š Installing PHP dependencies..."
composer install --no-dev --optimize-autoloader

echo "ğŸ—‚ Running database migrations..."
php artisan migrate --force

echo "ğŸ“ Setting correct permissions..."
chown -R www-data:www-data $PANEL_DIR

echo "ğŸ”„ Clearing cache..."
php artisan view:clear
php artisan
